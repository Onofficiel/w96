//!wrt $BSPEC:{"icn":"apps/blocks","cpr":"Copyright (C) Onofficiel 2024.","dsc":"Minecraft Java Edition 1.8.8 ported using EaglerCraft","frn":"Minecraft","aut":"Onofficiel | Mojang | EaglerCraft Team","ver":1.1,"ssy":"gui"} 

const gameStaticFiles=[{path:"./assets0",name:"assets0"},{path:"./assets1",name:"assets1"},{path:"./engine.js",name:"engine"}];let game_frame=null;const blobRegister=[];function registerFrameEvents(t){game_frame.addEventListener("load",(()=>{const e=game_frame.contentWindow;function n(){e.focus()}e.HTMLInputElement.prototype.__click=e.HTMLInputElement.prototype.click,e.HTMLInputElement.prototype.click=async function(){if(!this.files)return void this.__click();const t=await new Promise((async t=>{new w96.ui.OpenFileDialog("C:/user",[""],(async e=>{if(!e)return t(null);const n=await FS.toBlob(e),a=new File([n],FSUtil.fname(e),{type:n.type});return t(a)})).show()}));if(!t)return;const e=new Event("change",{}),n=new DataTransfer;n.items.add(t),this.files=n.files,Object.defineProperty(e,"target",{writable:!1,value:this}),this.dispatchEvent(e)},e.HTMLAnchorElement.prototype.click=async function(){if(this.download){let t=new Uint8Array([]);if(!(this.href.startsWith("blob:")||this.href.startsWith("data:")||this.href.startsWith("http:")||this.href.startsWith("https:")))return void DialogCreator.alert("Cannot save this file.",{icon:"error",title:"Minecraft"});{let e;try{e=await fetch(this.href).then((t=>t.blob()))}catch(t){return void DialogCreator.alert("Error while fetching the file.",{icon:"error",title:"Minecraft"})}t=new Uint8Array(await e.arrayBuffer())}const e=await showSaveDialog(FSUtil.getExtension(this.download));if(!e)return;const n=FSUtil.getParentPath(e);await FS.exists(n)||await FS.mkdir(n),await FS.writebin(e,t)}else w96.urlopen(this.href)},e.alert=alert,e.open=e=>{const n=t.createWindow({title:"Minecraft",initialHeight:300,initialWidth:400}),a=n.getBodyContainer(),r=document.createElement("iframe");for(a.appendChild(r),r.src=e;null===r.contentDocument;);Object.assign(r.style,{width:"100%",height:"100%",border:"none"});const i=r.contentWindow;return i.close=()=>n.close(),n.show(),i},e.addEventListener("blur",(()=>{e.addEventListener("click",n)})),e.addEventListener("focus",(()=>{e.removeEventListener("click",n)})),e.addEventListener("click",n),n()}))}async function constructIframeDocument(){let t='\n<!DOCTYPE html>\n\n<html>\n\n<head>\n\n<meta charset="UTF-8" />\n<meta name="viewport" content="width=device-width, initial-scale=1.0" />\n<meta name="description" content="EaglercraftX 1.8 Offline" />\n<meta name="keywords" content="eaglercraft, eaglercraftx, minecraft, 1.8, 1.8.8" />\n\n<title>EaglercraftX 1.8</title>\n\n<script type="text/javascript">\n"use strict";\nconst relayId = Math.floor(Math.random() * 3);\n\n// %%%%%%%%% launch options %%%%%%%%%%%%\n\nwindow.eaglercraftXOpts = {\n\tcontainer: "game_frame",\n\tworldsDB: "worlds",\n\trelays: [\n\t\t{ addr: "wss://relay.deev.is/", comment: "lax1dude relay #1", primary: relayId == 0 },\n\t\t{ addr: "wss://relay.lax1dude.net/", comment: "lax1dude relay #2", primary: relayId == 1 },\n\t\t{ addr: "wss://relay.shhnowisnottheti.me/", comment: "ayunami relay #1", primary: relayId == 2 }\n\t],\n\tassetsURI: [\n\t\t{ url: "%URL_STATICFILE_assets0%" },\n\t\t{ path: "assets/minecraft/lang/", url: "%URL_STATICFILE_assets1%" }\n\t]\n};\n\n// %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n\n<\/script>\n\n<script type="text/javascript" src="%URL_STATICFILE_engine%"><\/script>\n\n<script type="text/javascript">\n"use strict";\nwindow.addEventListener("load", () => {\n    main();\n});\n<\/script>\n\n</head>\n\n<body style="margin:0px;width:100vw;height:100vh;overflow:hidden" id="game_frame">\n</body>\n\n</html>\n\n';for(let e of gameStaticFiles){let n;try{n=FSUtil.resolvePath("C:/local/minecraft/data",e.path);const a=URL.createObjectURL(await FS.toBlob(n));t=t.replaceAll(`%URL_STATICFILE_${e.name}%`,a),blobRegister.push(a),console.log(`Asset file "${e.path}" loaded -> ${a}`)}catch(t){DialogCreator.alert(`Failed to load asset file ${n}.`,{icon:"error",title:"Minecraft"})}}return t}function cleanupFrameResources(){blobRegister.forEach((t=>URL.revokeObjectURL(t)))}function initIframe(t){return game_frame=document.createElement("iframe"),Object.assign(game_frame.style,{width:"100%",height:"100%",border:"none"}),registerFrameEvents(t),game_frame}async function startFrameGame(){game_frame.srcdoc=await constructIframeDocument()}const{Theme:Theme,DialogCreator:DialogCreator}=w96.ui;class Minecraft extends WApplication{constructor(){super()}async main(t){super.main(t);const e=this.createWindow({title:"Minecraft 1.8.8",taskbar:!0,resizable:!0,initialHeight:480,initialWidth:640,icon:await Theme.getIconUrl("apps/blocks","16x16")},!0),n=e.getBodyContainer(),a=initIframe(this);n.appendChild(a),e.show(),await startFrameGame()}async ontermination(){await super.ontermination(),cleanupFrameResources()}}

return await WApplication.execAsync(new Minecraft(), this.boxedEnv.args, this);